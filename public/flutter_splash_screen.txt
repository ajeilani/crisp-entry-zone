// Flutter Splash Screen Animation
// EXACT match of the Kalam web splash from Index.tsx
// Copy this entire file into your Flutter project

import 'package:flutter/material.dart';
import 'dart:math' as math;

class SplashScreen extends StatefulWidget {
  final VoidCallback? onComplete;
  
  const SplashScreen({super.key, this.onComplete});

  @override
  State<SplashScreen> createState() => _SplashScreenState();
}

class _SplashScreenState extends State<SplashScreen>
    with TickerProviderStateMixin {
  late AnimationController _ring1Controller;
  late AnimationController _ring2Controller;
  late AnimationController _ring3Controller;
  late AnimationController _pulseController;
  late AnimationController _bounce1Controller;
  late AnimationController _bounce2Controller;
  late AnimationController _fadeController;

  @override
  void initState() {
    super.initState();
    
    // Ring 1 - slow spin (8s) - matches: style={{ animationDuration: '8s' }}
    _ring1Controller = AnimationController(
      duration: const Duration(seconds: 8),
      vsync: this,
    )..repeat();
    
    // Ring 2 - medium reverse spin (6s) - matches: animationDirection: 'reverse'
    _ring2Controller = AnimationController(
      duration: const Duration(seconds: 6),
      vsync: this,
    )..repeat();
    
    // Ring 3 - fast spin (4s)
    _ring3Controller = AnimationController(
      duration: const Duration(seconds: 4),
      vsync: this,
    )..repeat();
    
    // Pulsing central orb - matches: animate-pulse
    _pulseController = AnimationController(
      duration: const Duration(seconds: 2),
      vsync: this,
    )..repeat(reverse: true);
    
    // Bounce animation 1 - matches: animationDuration: '2s'
    _bounce1Controller = AnimationController(
      duration: const Duration(seconds: 2),
      vsync: this,
    )..repeat(reverse: true);
    
    // Bounce animation 2 - matches: animationDuration: '2.5s', animationDelay: '0.5s'
    _bounce2Controller = AnimationController(
      duration: const Duration(milliseconds: 2500),
      vsync: this,
    );
    
    // Start bounce2 with 0.5s delay
    Future.delayed(const Duration(milliseconds: 500), () {
      if (mounted) {
        _bounce2Controller.repeat(reverse: true);
      }
    });
    
    // Fade out - matches: transition-opacity duration-700 (700ms)
    // Starts at 1500ms (fadeTimer), completes at 2300ms (hideTimer)
    _fadeController = AnimationController(
      duration: const Duration(milliseconds: 800), // 2300 - 1500 = 800ms
      vsync: this,
    );
    
    Future.delayed(const Duration(milliseconds: 1500), () {
      if (mounted) {
        _fadeController.forward().then((_) {
          widget.onComplete?.call();
        });
      }
    });
  }

  @override
  void dispose() {
    _ring1Controller.dispose();
    _ring2Controller.dispose();
    _ring3Controller.dispose();
    _pulseController.dispose();
    _bounce1Controller.dispose();
    _bounce2Controller.dispose();
    _fadeController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return FadeTransition(
      opacity: Tween<double>(begin: 1, end: 0).animate(
        CurvedAnimation(
          parent: _fadeController,
          curve: Curves.easeOut, // matches: transition-opacity duration-700
        ),
      ),
      child: Container(
        // matches: gradient-primary from index.css
        decoration: const BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
            colors: [Color(0xFF6366F1), Color(0xFF8B5CF6)],
          ),
        ),
        child: Center(
          child: SizedBox(
            width: 256, // matches: w-64 = 16rem = 256px
            height: 256, // matches: h-64
            child: Stack(
              alignment: Alignment.center,
              children: [
                // Central pulsing orb
                // matches: w-32 h-32 bg-white/20 rounded-full blur-xl animate-pulse
                AnimatedBuilder(
                  animation: _pulseController,
                  builder: (context, child) {
                    final pulse = Curves.easeInOut.transform(_pulseController.value);
                    final opacity = 0.15 + (pulse * 0.1); // pulse between 0.15 and 0.25
                    return Container(
                      width: 128, // w-32 = 8rem = 128px
                      height: 128, // h-32
                      decoration: BoxDecoration(
                        shape: BoxShape.circle,
                        color: Colors.white.withOpacity(opacity),
                        boxShadow: [
                          BoxShadow(
                            color: Colors.white.withOpacity(0.2),
                            blurRadius: 48, // blur-xl ≈ 24px * 2
                            spreadRadius: 0,
                          ),
                        ],
                      ),
                    );
                  },
                ),
                
                // Ring 1 - slow (8s)
                // matches: absolute inset-0 animate-spin style={{ animationDuration: '8s' }}
                AnimatedBuilder(
                  animation: _ring1Controller,
                  builder: (context, child) {
                    return Transform.rotate(
                      angle: _ring1Controller.value * 2 * math.pi,
                      child: SizedBox(
                        width: 256, // inset-0 = full container
                        height: 256,
                        child: Stack(
                          children: [
                            // matches: absolute top-0 left-1/2 -translate-x-1/2 w-8 h-8 bg-white/30 rounded-full blur-sm
                            Align(
                              alignment: Alignment.topCenter,
                              child: Container(
                                width: 32, // w-8 = 2rem = 32px
                                height: 32, // h-8
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.3), // bg-white/30
                                  boxShadow: [
                                    BoxShadow(
                                      color: Colors.white.withOpacity(0.15),
                                      blurRadius: 8, // blur-sm ≈ 4px * 2
                                    ),
                                  ],
                                ),
                              ),
                            ),
                            // matches: absolute bottom-0 left-1/2 -translate-x-1/2 w-6 h-6 bg-white/20 rounded-full blur-sm
                            Align(
                              alignment: Alignment.bottomCenter,
                              child: Container(
                                width: 24, // w-6 = 1.5rem = 24px
                                height: 24, // h-6
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.2), // bg-white/20
                                  boxShadow: [
                                    BoxShadow(
                                      color: Colors.white.withOpacity(0.1),
                                      blurRadius: 8, // blur-sm
                                    ),
                                  ],
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                    );
                  },
                ),
                
                // Ring 2 - medium reverse (6s)
                // matches: absolute inset-4 animate-spin style={{ animationDuration: '6s', animationDirection: 'reverse' }}
                AnimatedBuilder(
                  animation: _ring2Controller,
                  builder: (context, child) {
                    return Transform.rotate(
                      angle: -_ring2Controller.value * 2 * math.pi, // reverse direction
                      child: SizedBox(
                        width: 224, // inset-4 = 256 - (16*2) = 224px
                        height: 224,
                        child: Stack(
                          children: [
                            // matches: absolute top-0 right-0 w-5 h-5 bg-white/40 rounded-full
                            Align(
                              alignment: Alignment.topRight,
                              child: Container(
                                width: 20, // w-5 = 1.25rem = 20px
                                height: 20, // h-5
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.4), // bg-white/40
                                ),
                              ),
                            ),
                            // matches: absolute bottom-0 left-0 w-4 h-4 bg-white/25 rounded-full
                            Align(
                              alignment: Alignment.bottomLeft,
                              child: Container(
                                width: 16, // w-4 = 1rem = 16px
                                height: 16, // h-4
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.25), // bg-white/25
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                    );
                  },
                ),
                
                // Ring 3 - fast (4s)
                // matches: absolute inset-8 animate-spin style={{ animationDuration: '4s' }}
                AnimatedBuilder(
                  animation: _ring3Controller,
                  builder: (context, child) {
                    return Transform.rotate(
                      angle: _ring3Controller.value * 2 * math.pi,
                      child: SizedBox(
                        width: 192, // inset-8 = 256 - (32*2) = 192px
                        height: 192,
                        child: Stack(
                          children: [
                            // matches: absolute top-1/2 left-0 -translate-y-1/2 w-3 h-3 bg-white/50 rounded-full
                            Align(
                              alignment: Alignment.centerLeft,
                              child: Container(
                                width: 12, // w-3 = 0.75rem = 12px
                                height: 12, // h-3
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.5), // bg-white/50
                                ),
                              ),
                            ),
                            // matches: absolute top-1/2 right-0 -translate-y-1/2 w-4 h-4 bg-white/35 rounded-full
                            Align(
                              alignment: Alignment.centerRight,
                              child: Container(
                                width: 16, // w-4 = 1rem = 16px
                                height: 16, // h-4
                                decoration: BoxDecoration(
                                  shape: BoxShape.circle,
                                  color: Colors.white.withOpacity(0.35), // bg-white/35
                                ),
                              ),
                            ),
                          ],
                        ),
                      ),
                    );
                  },
                ),
                
                // Floating shape 1 (SQUARE with rotate-45)
                // matches: absolute top-1/4 left-1/4 w-6 h-6 bg-white/15 rounded-lg rotate-45 animate-bounce
                // style={{ animationDuration: '2s' }}
                AnimatedBuilder(
                  animation: _bounce1Controller,
                  builder: (context, child) {
                    final bounce = Curves.easeInOut.transform(_bounce1Controller.value);
                    final offsetY = bounce * 16; // bounce movement
                    return Positioned(
                      top: 64 - offsetY, // top-1/4 of 256 = 64px
                      left: 64, // left-1/4 of 256 = 64px
                      child: Transform.rotate(
                        angle: 45 * math.pi / 180, // rotate-45
                        child: Container(
                          width: 24, // w-6 = 1.5rem = 24px
                          height: 24, // h-6
                          decoration: BoxDecoration(
                            borderRadius: BorderRadius.circular(6), // rounded-lg
                            color: Colors.white.withOpacity(0.15), // bg-white/15
                          ),
                        ),
                      ),
                    );
                  },
                ),
                
                // Floating shape 2 (SQUARE with rotate-12)
                // matches: absolute bottom-1/4 right-1/4 w-5 h-5 bg-white/20 rounded-lg rotate-12 animate-bounce
                // style={{ animationDuration: '2.5s', animationDelay: '0.5s' }}
                AnimatedBuilder(
                  animation: _bounce2Controller,
                  builder: (context, child) {
                    final bounce = Curves.easeInOut.transform(_bounce2Controller.value);
                    final offsetY = bounce * 16; // bounce movement
                    return Positioned(
                      bottom: 64 - offsetY, // bottom-1/4 of 256 = 64px
                      right: 64, // right-1/4 of 256 = 64px
                      child: Transform.rotate(
                        angle: 12 * math.pi / 180, // rotate-12
                        child: Container(
                          width: 20, // w-5 = 1.25rem = 20px
                          height: 20, // h-5
                          decoration: BoxDecoration(
                            borderRadius: BorderRadius.circular(6), // rounded-lg
                            color: Colors.white.withOpacity(0.2), // bg-white/20
                          ),
                        ),
                      ),
                    );
                  },
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}


// ============================================
// USAGE EXAMPLE
// ============================================

// In your main.dart or initial route:

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      home: SplashWrapper(),
    );
  }
}

class SplashWrapper extends StatefulWidget {
  const SplashWrapper({super.key});

  @override
  State<SplashWrapper> createState() => _SplashWrapperState();
}

class _SplashWrapperState extends State<SplashWrapper> {
  bool _showSplash = true;

  @override
  Widget build(BuildContext context) {
    return Stack(
      children: [
        // Your main app content
        const HomeScreen(),
        
        // Splash overlay
        if (_showSplash)
          SplashScreen(
            onComplete: () {
              setState(() {
                _showSplash = false;
              });
            },
          ),
      ],
    );
  }
}

// Placeholder home screen
class HomeScreen extends StatelessWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        decoration: const BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topLeft,
            end: Alignment.bottomRight,
            colors: [Color(0xFF6366F1), Color(0xFF8B5CF6)],
          ),
        ),
        child: const Center(
          child: Text(
            'Kalam',
            style: TextStyle(
              fontSize: 48,
              fontWeight: FontWeight.bold,
              color: Colors.white,
            ),
          ),
        ),
      ),
    );
  }
}
